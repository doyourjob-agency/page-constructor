import{ac as M,ad as E}from"./iframe-BaOgIThH.js";const d=/{{(.*?)}}/g;function k(i,e){let a="",s=d.lastIndex=0,t;for(;t=d.exec(i);){s!==t.index&&(a+=i.slice(s,t.index)),s=d.lastIndex;const[n,g]=t;g&&Object.prototype.hasOwnProperty.call(e,g)?a+=e[g]:a+=n}return s<i.length&&(a+=i.slice(s)),a}const r={EmptyKeyset:"EMPTY_KEYSET",EmptyLanguageData:"EMPTY_LANGUAGE_DATA",KeysetNotFound:"KEYSET_NOT_FOUND",MissingKey:"MISSING_KEY",MissingKeyFor0:"MISSING_KEY_FOR_0",MissingKeyParamsCount:"MISSING_KEY_PARAMS_COUNT",MissingKeyPlurals:"MISSING_KEY_PLURALS",NoLanguageData:"NO_LANGUAGE_DATA"};function y(i){const{code:e,fallbackLang:a,lang:s}=i;let t=`Using language ${s}. `;switch(e){case r.EmptyKeyset:{t+="Keyset is empty.";break}case r.EmptyLanguageData:{t+="Language data is empty.";break}case r.KeysetNotFound:{t+="Keyset not found.";break}case r.MissingKey:{t+="Missing key.";break}case r.MissingKeyFor0:return t+="Missing key for 0",t;case r.MissingKeyParamsCount:{t+="Missing params.count for key.";break}case r.MissingKeyPlurals:{t+="Missing required plurals.";break}case r.NoLanguageData:t=`Language "${s}" is not defined, make sure you call setLang for the same language you called registerKeysets for!`}return a&&(t+=` Trying to use fallback language "${a}"...`),t}var u;(function(i){i[i.One=0]="One",i[i.Few=1]="Few",i[i.Many=2]="Many",i[i.None=3]="None"})(u||(u={}));function b(i,e){return i===0?e.None:i===1||i===-1?e.One:e.Many}function p(i,e){const a=Math.abs(i%10),s=Math.abs(i%100);return i===0?e.None:a===1&&s!==11?e.One:a>1&&a<5&&(s<10||s>20)?e.Few:e.Many}class N{constructor(e={}){this.data={},this.pluralizers={en:b,ru:p},this.logger=null;const{data:a,fallbackLang:s,lang:t,logger:n=null}=e;this.fallbackLang=s,this.lang=t,this.logger=n,a&&Object.entries(a).forEach(([g,c])=>{this.registerKeysets(g,c)})}setLang(e){this.lang=e}setFallbackLang(e){this.fallbackLang=e}configurePluralization(e){this.pluralizers=Object.assign({},this.pluralizers,e)}registerKeyset(e,a,s={}){const t=this.data[e]&&Object.prototype.hasOwnProperty.call(this.data[e],a);if(t)throw new Error(`Keyset '${a}' is already registered, aborting!`);t&&this.warn(`Keyset '${a}' is already registered.`),this.data[e]=Object.assign({},this.data[e],{[a]:s})}registerKeysets(e,a){Object.keys(a).forEach(s=>{this.registerKeyset(e,s,a[s])})}has(e,a,s){var t;const n=this.getLanguageData(s);return!!(n&&n[e]&&(!((t=n[e])===null||t===void 0)&&t[a]))}i18n(e,a,s){if(!this.lang&&!this.fallbackLang)throw new Error('Language is not specified. You should set at least one of these: "lang", "fallbackLang"');let t,n;if(this.lang){if({text:t,details:n}=this.getTranslationData({keysetName:e,key:a,params:s,lang:this.lang}),n){const g=y({code:n.code,lang:this.lang,fallbackLang:this.fallbackLang===this.lang?void 0:this.fallbackLang});this.warn(g,n.keysetName,n.key)}}else this.warn("Target language is not specified.");if(t===void 0&&this.fallbackLang&&this.fallbackLang!==this.lang&&({text:t,details:n}=this.getTranslationData({keysetName:e,key:a,params:s,lang:this.fallbackLang}),n)){const g=y({code:n.code,lang:this.fallbackLang});this.warn(g,n.keysetName,n.key)}return t??a}keyset(e){return(a,s)=>this.i18n(e,a,s)}warn(e,a,s){var t;let n="";a?(n+=a,s&&(n+=`.${s}`)):n="languageData",(t=this.logger)===null||t===void 0||t.log(`I18n: ${e}`,{level:"info",logger:n,extra:{type:"i18n"}})}getLanguageData(e){const a=e||this.lang;return a?this.data[a]:void 0}getLanguagePluralizer(e){const a=e?this.pluralizers[e]:void 0;return a||this.warn(`Pluralization is not configured for language '${e}', falling back to the english ruleset`),a||b}getTranslationData(e){const{lang:a,key:s,keysetName:t,params:n}=e,g=this.getLanguageData(a);if(typeof g>"u")return{details:{code:r.NoLanguageData}};if(Object.keys(g).length===0)return{details:{code:r.EmptyLanguageData}};const c=g[t];if(!c)return{details:{code:r.KeysetNotFound,keysetName:t}};if(Object.keys(c).length===0)return{details:{code:r.EmptyKeyset,keysetName:t}};const l=c&&c[s],o={};if(l===void 0)return{details:{code:r.MissingKey,keysetName:t,key:s}};if(Array.isArray(l)){if(l.length<3)return{details:{code:r.MissingKeyPlurals,keysetName:t,key:s}};const h=Number(n==null?void 0:n.count);if(Number.isNaN(h))return{details:{code:r.MissingKeyParamsCount,keysetName:t,key:s}};const L=this.getLanguagePluralizer(a);if(o.text=l[L(h,u)]||l[u.Many],o.text===void 0)return{details:{code:r.MissingKeyPlurals,keysetName:t,key:s}};l[u.None]===void 0&&(o.details={code:r.MissingKeyFor0,keysetName:t,key:s})}else o.text=l;return n&&(o.text=k(o.text,n)),o}}const K=M().lang,f=new N({lang:K,fallbackLang:K});E(i=>{f.setLang(i.lang)});function O(i,e){return Object.entries(i).forEach(([a,s])=>f.registerKeyset(a,e,s)),f.keyset(e)}export{N as I,O as a};
